---
layout: null
---

<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page.title | default: "Projects" }} — {{ site.title }}</title>

    <!-- Base visual (nav, wrap, secciones, pills, links) -->
    <link rel="stylesheet" href="/css/blog.css" />
    <!-- Solo “extensiones” para tarjetas/grid de proyectos -->
    <link rel="stylesheet" href="/css/projects.css" />

    {% include mathjax.html %}
  </head>

  <body class="projects-page">
    {% include nav.html %}

    <main class="projects-wrap">
      <header class="blog-hero projects-hero">
        <div class="hero-kicker">PORTFOLIO</div>
        <h1 class="hero-title">{{ page.title | default: "Projects" }}</h1>

        <p class="blog-quote-text">
          A curated list of missions, simulations, and tools. Minimal, documented, and continuously improved.
        </p>

        <div class="hero-actions">
          <a class="hero-action" href="#tags">Tags</a>
          <a class="hero-action" href="#projects">Projects</a>
        </div>

        <div class="hero-rule"></div>
      </header>

      {% assign projects = site.data.projects %}
      {% if projects == nil %}
        {% assign projects = "" | split: "" %}
      {% endif %}

      {% assign projects_sorted = projects | sort: "year" | reverse %}

      {%- comment -%} Build unique tag list {%- endcomment -%}
      {% assign tag_string = "" %}
      {% for p in projects_sorted %}
        {% if p.tags %}
          {% for t in p.tags %}
            {% assign tag_string = tag_string | append: t | append: "|" %}
          {% endfor %}
        {% endif %}
      {% endfor %}
      {% assign tags_all = tag_string | split: "|" | sort %}
      {% assign tags_unique = "" | split: "" %}
      {% for t in tags_all %}
        {% if t != "" %}
          {% if tags_unique contains t %}
          {% else %}
            {% assign tags_unique = tags_unique | push: t %}
          {% endif %}
        {% endif %}
      {% endfor %}

      <!-- TAGS -->
      <section id="tags" class="blog-section">
        <div class="section-head">
          <div class="section-title">Tags</div>
          <div class="section-meta"><span id="tagCount">{{ tags_unique | size }}</span></div>
        </div>

        {% if tags_unique == nil or tags_unique.size == 0 %}
          <div class="empty-state"><p>No tags yet.</p></div>
        {% else %}
          <div class="tag-cloud" id="tagCloud" aria-label="Project tag filters">
            <button class="tag-pill is-active" type="button" data-tag="__all" data-label="All">All</button>

            {% for t in tags_unique %}
              {% assign ts = t | slugify %}
              <button
                class="tag-pill"
                type="button"
                id="tag-{{ ts }}"
                data-tag="{{ ts }}"
                data-label="{{ t }}">
                {{ t }}
              </button>
            {% endfor %}

            <button class="tag-pill tag-pill-clear" type="button" id="clearTags">Clear</button>
          </div>

          <div class="filter-hint" id="filterHint" style="display:none;">
            Filtering by: <span id="filterList"></span>
          </div>
        {% endif %}
      </section>

      <!-- PROJECTS -->
      <section id="projects" class="blog-section">
        <div class="section-head">
          <div class="section-title">All projects</div>
          <div class="section-meta">
            <span id="projectsVisible">{{ projects_sorted | size }}</span>/<span id="projectsTotal">{{ projects_sorted | size }}</span>
          </div>
        </div>

        {% if projects_sorted == nil or projects_sorted.size == 0 %}
          <div class="empty-state">
            <p>No projects loaded yet. Add entries to <code>_data/projects.yml</code>.</p>
          </div>
        {% else %}
          <div class="projects-grid" id="projectsList">
            {% for p in projects_sorted %}
              {% assign tags_attr = "" %}
              {% if p.tags %}
                {% for t in p.tags %}
                  {% assign tags_attr = tags_attr | append: (t | slugify) | append: "|" %}
                {% endfor %}
              {% endif %}

              {% assign project_url = p.url | default: "/projects/" | append: p.slug | append: "/" %}

              <article class="project-card" data-tags="{{ tags_attr }}" data-url="{{ project_url | relative_url }}">
                <div class="project-meta">
                  {% if p.status %}<span class="pill">{{ p.status }}</span>{% endif %}
                  {% if p.year %}<span class="dot">•</span><span class="meta-text">{{ p.year }}</span>{% endif %}
                  {% if p.category %}<span class="dot">•</span><span class="meta-text">{{ p.category }}</span>{% endif %}
                </div>

                <h2 class="project-title">
                  <a href="{{ project_url | relative_url }}">{{ p.title }}</a>
                </h2>

                {% if p.role %}
                  <div class="project-role">{{ p.role }}</div>
                {% endif %}

                {% if p.summary %}
                  <p class="project-summary">{{ p.summary }}</p>
                {% endif %}

                {% if p.tags %}
                  <div class="chips">
                    {% for t in p.tags %}
                      <button
                        class="chip chip-link"
                        type="button"
                        data-tag="{{ t | slugify }}"
                        data-label="{{ t }}">
                        {{ t }}
                      </button>
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="post-links">
                  <!-- READ siempre al propio proyecto -->
                  <a class="link" href="{{ project_url | relative_url }}">READ</a>

                  {% if p.links %}
                    {% for l in p.links %}
                      <a class="link" href="{{ l.url }}">{{ l.label }}</a>
                    {% endfor %}
                  {% endif %}
                </div>
              </article>
            {% endfor %}
          </div>
        {% endif %}
      </section>

      <footer class="blog-footer">
        <div class="footer-rule"></div>
        <div class="footer-text">Last updated: {{ "now" | date: "%Y-%m-%d" }}</div>
      </footer>
    </main>

    <script>
      (function () {
        const tagCloud = document.getElementById("tagCloud");
        const clearBtn = document.getElementById("clearTags");
        const hint = document.getElementById("filterHint");
        const filterList = document.getElementById("filterList");

        const list = document.getElementById("projectsList");
        const visibleEl = document.getElementById("projectsVisible");
        const totalEl = document.getElementById("projectsTotal");

        if (!tagCloud || !list) return;

        const tagButtons = Array.from(tagCloud.querySelectorAll("[data-tag]"));
        const allBtn = tagCloud.querySelector('[data-tag="__all"]');
        const cards = Array.from(list.querySelectorAll(".project-card"));

        const total = cards.length;
        if (totalEl) totalEl.textContent = String(total);

        // OR logic: show if card has ANY selected tag
        const selected = new Set(); // stores slugified tags

        function getCardTags(card) {
          const raw = (card.getAttribute("data-tags") || "")
            .split("|")
            .map(s => s.trim())
            .filter(Boolean);
          return new Set(raw);
        }

        function setButtonActive(tag, isActive) {
          const btn = tagCloud.querySelector(`[data-tag="${CSS.escape(tag)}"]`);
          if (!btn) return;
          btn.classList.toggle("is-active", isActive);
        }

        function syncAllButton() {
          const hasFilters = selected.size > 0;
          if (allBtn) allBtn.classList.toggle("is-active", !hasFilters);
        }

        function renderHint() {
          if (!hint || !filterList) return;
          if (selected.size === 0) {
            hint.style.display = "none";
            filterList.textContent = "";
            return;
          }
          hint.style.display = "";
          const labels = Array.from(selected).map(tag => {
            const btn = tagCloud.querySelector(`[data-tag="${CSS.escape(tag)}"]`);
            return btn?.getAttribute("data-label") || tag;
          });
          filterList.textContent = labels.join(", ");
        }

        function applyFilter() {
          let shown = 0;

          cards.forEach(card => {
            const tags = getCardTags(card);

            let ok = true;
            if (selected.size > 0) {
              ok = false;
              for (const t of selected) {
                if (tags.has(t)) { ok = true; break; }
              }
            }

            card.style.display = ok ? "" : "none";
            if (ok) shown++;
          });

          if (visibleEl) visibleEl.textContent = String(shown);
          syncAllButton();
          renderHint();
        }

        function clearSelection() {
          selected.clear();
          tagButtons.forEach(btn => btn.classList.remove("is-active"));
          if (allBtn) allBtn.classList.add("is-active");
          applyFilter();
        }

        // Click on top tag pills
        tagCloud.addEventListener("click", (e) => {
          const btn = e.target.closest("[data-tag]");
          if (!btn) return;

          const tag = (btn.getAttribute("data-tag") || "").trim();
          if (!tag) return;

          if (tag === "__all") {
            clearSelection();
            return;
          }

          if (selected.has(tag)) {
            selected.delete(tag);
            btn.classList.remove("is-active");
          } else {
            selected.add(tag);
            btn.classList.add("is-active");
          }

          applyFilter();
        });

        if (clearBtn) clearBtn.addEventListener("click", clearSelection);

        // Click on chips inside cards also toggles filters
        list.addEventListener("click", (e) => {
          const chip = e.target.closest(".chip-link[data-tag]");
          if (!chip) return;
          e.preventDefault();

          const tag = (chip.getAttribute("data-tag") || "").trim();
          if (!tag) return;

          if (selected.has(tag)) {
            selected.delete(tag);
            setButtonActive(tag, false);
          } else {
            selected.add(tag);
            setButtonActive(tag, true);
          }

          applyFilter();
        });

        // init
        clearSelection();

        // Optional: support deep-link from project page: /proyectos/#tag-cfd
        if (location.hash && location.hash.startsWith("#tag-")) {
          const tag = location.hash.replace("#tag-", "").trim();
          if (tag) {
            selected.add(tag);
            setButtonActive(tag, true);
            applyFilter();
          }
        }
      })();
    </script>
  </body>
</html>
